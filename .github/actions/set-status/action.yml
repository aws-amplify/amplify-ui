name: 'Set Status'
description: 'Set status on a specified head-sha'
inputs:
  context:
    description: 'Name of the status'
    required: true
  description:
    description: 'Short description of the status'
    required: false
  state:
    description: >-
      State of the status with possible values of 'error', 'failure', 'pending', 'success'
    required: true
  sha:
    description: 'The commit ID to add the status to'
    required: true
  target-url:
    description: >-
      Target URL to associate with this status.
      This URL will be linked from the GitHub UI to allow users to easily see the source of the status.'
    required: false
runs:
  using: 'composite'
  steps:
    - name: Set a commit status
      id: set-status
      uses: actions/github-script@98814c53be79b1d30f795b907e553d8679345975 # v6.4.0 https://github.com/actions/github-script/commit/98814c53be79b1d30f795b907e553d8679345975
      env:
        status_context: ${{ inputs.context }}
        description: ${{ inputs.description }}
        state: ${{ inputs.state }}
        sha: ${{ inputs.sha }}
        target_url: ${{ inputs.target-url }}
        owner: ${{ github.event.repository.owner.login }}
        repo: ${{ github.event.repository.name }}
      with:
        result-encoding: string
        script: |
          const { status_context, description, state, sha, target_url, owner, repo } = process.env;
          try {
            if (state.length == 0) {
              throw new Error('"state" input cannot be empty.');
            }

            if (!["error", "failure", "pending", "success"].includes(state)) {
              throw new Error('"state" must be a string input with possible value of 'error', 'failure', 'pending', 'success'.');
            }

            if (context.length <= 0) {
              throw new Error('"context" input cannot be empty.');
            }

            if (sha.length <= 0) {
              throw new Error('"sha" input cannot be empty.');
            }

            if (!input_string.match(/^[0-9a-z]+$/)) {
              throw new Error('"sha" must be an alphanumeric string.');
            }
          } catch (e) {
            core.setFailed(e.message);
            return;
          }
          github.rest.repos.createCommitStatus({
            owner,
            repo,
            sha,
            state,
            context: status_context,
            description: description.length > 0 ? description : undefined,
            target_url: target_url.length > 0 ? target_url : undefined,
          });
