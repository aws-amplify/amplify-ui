import { Accordion, Alert, Image } from '@aws-amplify/ui-react';

import { ComponentStyleDisplay } from '@/components/ComponentStyleDisplay';
import { Example, ExampleCode } from '@/components/Example';
import { InlineFilter } from '@/components/InlineFilter';
import AppDirectoryAlert from '@/components/AppDirectoryAlert';
import { InstallScripts } from '@/components/InstallScripts';
import ReactPropsTable from '@/components/propsTable/ReactPropsTable';
import { STORAGE_IMAGE } from './props';
import {
  DefaultStorageImageExample,
  StorageImageErrorHandlingExample
} from './examples'

## Basic Usage

<Alert variation="warning" heading="Wait!">
  Did you follow the [quick start instructions](/connected-components/storage#quick-start) to set up the storage and auth services?
</Alert>

<InlineFilter filters={['react']}>
  <AppDirectoryAlert />
</InlineFilter>

To use the StorageImage component, import it into your React application with the included styles. 

<InstallScripts component="storage" />

<ExampleCode>
```js
import { StorageImage } from '@aws-amplify/ui-react-storage';
import '@aws-amplify/ui-react/styles.css';
```
</ExampleCode>

At a minimum you must include the `alt` and `path` props. `path` is a full S3 object key and refers to the [Amplify Storage path](https://docs.amplify.aws/react/build-a-backend/storage/download-files/). It is either a `string` or a callback function that accepts the current user's Cognito `identityId` and returns a `string`.

<Example>
  <Image alt='cat' src='/cats/1.jpg' width="400px" height="400px" />
  <ExampleCode>
    ```jsx file=./examples/DefaultStorageImageExample.tsx
    ```
  </ExampleCode>
</Example>

<Accordion.Container>
  <Accordion.Item key={"title"} value={"title"}>
    <Accordion.Trigger>
      Using `@aws-amplify/ui-react-storage` version 3.0.1x or below?
      <Accordion.Icon />
    </Accordion.Trigger>
    <Accordion.Content>
      Versions 3.0.18 and earlier use `imgKey`, `accessLevel`, and `identityId` in place of the `path` prop.
      ```diff
      <StorageImage 
         alt="sleepy-cat" 
      -  path="guest/cat.jpg"
      +  accessLevel="guest" 
      +  imgKey="cat.jpg" 
      />

       <StorageImage 
         alt="sleepy-cat" 
      -  path={`private/${identityId}/cat.jpg`}
      +  accessLevel="private"
      +  identityId={identityId} 
      +  imgKey="cat.jpg" 
      />
      ```
    </Accordion.Content>
  </Accordion.Item>
</Accordion.Container>

## Props

<ReactPropsTable props={STORAGE_IMAGE} />

## Error Handling

To handle the error caused by `Storage.get`, you can pass a `onGetUrlError` handler and optionally provide a `fallbackSrc` for the component to load a fallback image.

<Example>
 <Image alt='fallback cat' src='/cats/2.jpg' width="400px" height="400px" />
  <ExampleCode>
    ```jsx file=./examples/StorageImageErrorHandlingExample.tsx
    ```
  </ExampleCode>
</Example>

<Accordion.Container>
  <Accordion.Item key={"title"} value={"title"}>
    <Accordion.Trigger>
      Using `@aws-amplify/ui-react-storage` version 3.0.1x or below?
      <Accordion.Icon />
    </Accordion.Trigger>
    <Accordion.Content>
      Versions 3.0.18 and earlier use `onStorageGetError` in place of the `onGetUrlError` prop.
    ```diff
    <StorageImage
       alt="fallback cat"
       accessLevel="guest"
       imgKey="cat.jpg"
       fallbackSrc="/fallback_cat.jpg"
    -  onGetUrlError={(error) => console.error(error)}
    +  onStorageGetError={(error) => console.error(error)}
    />
    ```
    </Accordion.Content>
  </Accordion.Item>
</Accordion.Container>

## Customization

### Target Classes
<ComponentStyleDisplay componentName="StorageImage" />
