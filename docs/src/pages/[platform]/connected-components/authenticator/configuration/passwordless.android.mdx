import { Alert } from '@aws-amplify/ui-react';

### Passwordless Authentication

<Alert role="none" variation="info" heading="Platform Requirements">
  Passkey support requires Android API level 28+ with Google Play Services.
</Alert>

#### Backend Configuration

For backend setup including Email OTP, SMS OTP, and WebAuthn (Passkey) configuration, see the [Passwordless documentation](https://docs.amplify.aws/android/build-a-backend/auth/concepts/passwordless/).

#### Authentication Flows

The Authenticator supports two authentication flows:

**Password Flow (Default)**

Traditional password-based authentication:

```kotlin
val authenticatorState = rememberAuthenticatorState(
    authenticationFlow = AuthenticationFlow.Password
)
Authenticator(
    state = authenticatorState
) { state ->
    Text("Welcome!")
}
```

**User Choice Flow**

Allows users to choose from available authentication methods:

```kotlin
val authenticatorState = rememberAuthenticatorState(
    authenticationFlow = AuthenticationFlow.UserChoice()
)
Authenticator(
    state = authenticatorState
) { state ->
    Text("Welcome!")
}
```

#### Available Authentication Factors

| Factor | Description | Code |
|--------|-------------|------|
| Password | Traditional password with SRP | `AuthFactor.Password(srp = true)` |
| Password (no SRP) | Password without SRP | `AuthFactor.Password(srp = false)` |
| Email OTP | One-time code via email | `AuthFactor.EmailOtp` |
| SMS OTP | One-time code via SMS | `AuthFactor.SmsOtp` |
| WebAuthn (Passkey) | Biometric/security key authentication | `AuthFactor.WebAuthn` |

#### Preferred Auth Factor

Skip the factor selection step by specifying a preferred factor:

```kotlin
val authenticatorState = rememberAuthenticatorState(
    authenticationFlow = AuthenticationFlow.UserChoice(
        preferredAuthFactor = AuthFactor.WebAuthn
    )
)
Authenticator(
    state = authenticatorState
) { state ->
    Text("Welcome!")
}
```

When a preferred factor is set:
- If the user has that factor available, they'll use it directly
- If not available, they'll see the factor selection screen

#### Passkey Prompts

Control when users are prompted to create a passkey:

```kotlin
val authenticatorState = rememberAuthenticatorState(
    authenticationFlow = AuthenticationFlow.UserChoice(
        passkeyPrompts = PasskeyPrompts(
            afterSignUp = PasskeyPrompt.Always,  // Prompt after sign-up
            afterSignIn = PasskeyPrompt.Never    // Don't prompt after sign-in
        )
    )
)
Authenticator(
    state = authenticatorState
) { state ->
    Text("Welcome!")
}
```

**PasskeyPrompt Options:**
- `PasskeyPrompt.Always` - Always prompt to create a passkey (if user doesn't have one)
- `PasskeyPrompt.Never` - Never prompt to create a passkey

#### Authentication Flow Steps

When using `UserChoice` flow, users may encounter these additional steps:

1. **SignInSelectAuthFactor** - User selects their preferred authentication method
2. **SignInConfirmPassword** - User enters password (if password factor selected)
3. **PromptToCreatePasskey** - User is prompted to create a passkey
4. **PasskeyCreated** - Confirmation after successful passkey creation

#### Complete Example

```kotlin
val authenticatorState = rememberAuthenticatorState(
    authenticationFlow = AuthenticationFlow.UserChoice(
        preferredAuthFactor = AuthFactor.WebAuthn,
        passkeyPrompts = PasskeyPrompts(
            afterSignUp = PasskeyPrompt.Always,
            afterSignIn = PasskeyPrompt.Always
        )
    )
)
Authenticator(
    state = authenticatorState
) { state ->
    Text("Welcome!")
}
```
